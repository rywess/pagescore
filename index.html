<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PageScore â€” AEO Â· GEO Â· SEO Analyzer</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<style>
  :root {
    --bg: #faf8f7;
    --surface: #ffffff;
    --surface2: #fdf4f2;
    --border: #f0e8e5;
    --border-strong: #e0ceca;
    --text: #1a1018;
    --muted: #8a7a78;
    --muted-light: #c4b4b0;
    --cherry: #e8294a;
    --cherry-light: #fde8ec;
    --cherry-mid: #f5a0b0;
    --seo: #1a9e6e;
    --seo-light: #e6f7f1;
    --aeo: #e8662a;
    --aeo-light: #fef0e8;
    --geo: #6b4fc8;
    --geo-light: #f0ecfb;
    --warn: #d97706;
    --warn-light: #fef3cd;
    --danger: #dc2626;
    --shadow-sm: 0 1px 3px rgba(26,16,24,0.06), 0 1px 2px rgba(26,16,24,0.04);
    --shadow-md: 0 4px 16px rgba(26,16,24,0.08), 0 2px 6px rgba(26,16,24,0.04);
    --radius: 16px;
    --radius-sm: 10px;
    --radius-xs: 6px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Plus Jakarta Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--cherry), #ff8fa3, var(--aeo));
    z-index: 100;
    pointer-events: none;
  }

  .container {
    max-width: 1060px;
    margin: 0 auto;
    padding: 52px 24px 80px;
    position: relative;
  }

  header {
    text-align: center;
    margin-bottom: 44px;
  }

  .logo {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
  }

  .logo-icon {
    width: 32px; height: 32px;
    background: var(--cherry);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
  }

  .logo-text {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text);
    letter-spacing: -0.3px;
  }

  h1 {
    font-size: clamp(2rem, 4.5vw, 3.2rem);
    font-weight: 800;
    letter-spacing: -1.5px;
    line-height: 1.1;
    margin-bottom: 12px;
    color: var(--text);
  }

  h1 span.aeo { color: var(--aeo); }
  h1 span.geo { color: var(--geo); }
  h1 span.seo { color: var(--seo); }

  .subtitle {
    color: var(--muted);
    font-size: 1rem;
    font-weight: 500;
  }

  .input-section {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 28px;
    box-shadow: var(--shadow-md);
  }

  .input-tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 18px;
    background: var(--surface2);
    border-radius: var(--radius-sm);
    padding: 4px;
    width: fit-content;
  }

  .input-tab {
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.82rem;
    font-weight: 600;
    font-family: 'Plus Jakarta Sans', sans-serif;
    cursor: pointer;
    border: none;
    background: transparent;
    color: var(--muted);
    transition: all 0.15s;
  }

  .input-tab.active {
    background: var(--surface);
    color: var(--text);
    box-shadow: var(--shadow-sm);
  }

  .input-tab:hover:not(.active) { color: var(--text); }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  .input-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .url-input {
    flex: 1;
    min-width: 260px;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 13px 16px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.87rem;
    outline: none;
    transition: border-color 0.15s, box-shadow 0.15s;
  }

  .url-input:focus {
    border-color: var(--cherry);
    box-shadow: 0 0 0 3px var(--cherry-light);
    background: var(--surface);
  }

  .url-input::placeholder { color: var(--muted-light); }

  .analyze-btn {
    background: var(--cherry);
    border: none;
    border-radius: var(--radius-sm);
    padding: 13px 24px;
    color: #fff;
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    white-space: nowrap;
    box-shadow: 0 2px 8px rgba(232,41,74,0.25);
  }

  .analyze-btn:hover {
    background: #d01f3a;
    transform: translateY(-1px);
    box-shadow: 0 4px 14px rgba(232,41,74,0.3);
  }

  .analyze-btn:active { transform: translateY(0); }
  .analyze-btn:disabled {
    background: var(--muted-light);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .file-drop-zone {
    border: 2px dashed var(--border-strong);
    border-radius: var(--radius-sm);
    padding: 32px 24px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.15s, background 0.15s;
    position: relative;
    background: var(--surface2);
  }

  .file-drop-zone:hover, .file-drop-zone.dragover {
    border-color: var(--cherry);
    background: var(--cherry-light);
  }

  .file-drop-zone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }

  .file-drop-icon { font-size: 1.8rem; margin-bottom: 8px; }

  .file-drop-label {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--text);
  }

  .file-drop-sub {
    font-size: 0.75rem;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
  }

  .file-selected {
    display: none;
    align-items: center;
    gap: 10px;
    background: var(--cherry-light);
    border: 1.5px solid var(--cherry-mid);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    margin-top: 10px;
  }

  .file-selected.active { display: flex; }

  .file-selected-name {
    flex: 1;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    color: var(--cherry);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 500;
  }

  .file-clear {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 1rem;
    padding: 0 4px;
    line-height: 1;
  }

  .file-clear:hover { color: var(--danger); }

  .file-analyze-row {
    margin-top: 14px;
    display: flex;
    justify-content: flex-end;
  }

  .paste-instructions {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    font-size: 0.78rem;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    margin-bottom: 12px;
    padding: 10px 14px;
    background: var(--surface2);
    border-radius: var(--radius-sm);
    border: 1.5px solid var(--border);
    line-height: 1.6;
  }

  .paste-step {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px; height: 20px;
    border-radius: 50%;
    background: var(--cherry);
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    flex-shrink: 0;
  }

  kbd {
    background: var(--surface);
    border: 1.5px solid var(--border-strong);
    border-radius: 4px;
    padding: 1px 6px;
    font-family: 'DM Mono', monospace;
    font-size: 0.75rem;
    color: var(--text);
    font-weight: 500;
  }

  .paste-textarea {
    width: 100%;
    height: 150px;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.78rem;
    resize: vertical;
    outline: none;
    transition: border-color 0.15s, box-shadow 0.15s;
    line-height: 1.5;
  }

  .paste-textarea:focus {
    border-color: var(--cherry);
    box-shadow: 0 0 0 3px var(--cherry-light);
    background: var(--surface);
  }

  .paste-textarea::placeholder { color: var(--muted-light); }

  .paste-bottom-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 10px;
    flex-wrap: wrap;
    gap: 10px;
  }

  .paste-char-count {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--muted);
  }

  .clear-paste-btn {
    background: transparent;
    border: 1.5px solid var(--border-strong);
    border-radius: var(--radius-sm);
    padding: 10px 16px;
    color: var(--muted);
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: border-color 0.15s, color 0.15s;
  }

  .clear-paste-btn:hover { border-color: var(--danger); color: var(--danger); }

  .loading {
    display: none;
    text-align: center;
    padding: 56px 0;
  }

  .loading.active { display: block; }

  .spinner {
    width: 44px; height: 44px;
    border: 3px solid var(--border);
    border-top-color: var(--cherry);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-steps {
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    color: var(--muted);
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: center;
  }

  .loading-step { opacity: 0; transition: opacity 0.4s; }
  .loading-step.visible { opacity: 1; }
  .loading-step.done { color: var(--seo); }

  #results { display: none; }
  #results.active { display: block; }

  .score-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    margin-bottom: 16px;
  }

  @media (max-width: 640px) {
    .score-cards { grid-template-columns: 1fr; }
  }

  .score-card {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    padding: 22px;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: box-shadow 0.2s, transform 0.2s;
  }

  .score-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }

  .score-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    border-radius: 3px 3px 0 0;
  }

  .score-card.seo::before { background: var(--seo); }
  .score-card.aeo::before { background: var(--aeo); }
  .score-card.geo::before { background: var(--geo); }

  .card-label {
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 3px;
  }

  .card-label.seo { color: var(--seo); }
  .card-label.aeo { color: var(--aeo); }
  .card-label.geo { color: var(--geo); }

  .card-name {
    font-size: 0.8rem;
    color: var(--muted);
    margin-bottom: 18px;
    font-weight: 500;
  }

  .score-display {
    display: flex;
    align-items: flex-end;
    gap: 4px;
    margin-bottom: 14px;
  }

  .score-number {
    font-size: 3.2rem;
    font-weight: 800;
    line-height: 1;
    letter-spacing: -2px;
  }

  .score-number.seo { color: var(--seo); }
  .score-number.aeo { color: var(--aeo); }
  .score-number.geo { color: var(--geo); }

  .score-denom {
    font-size: 1rem;
    color: var(--muted-light);
    margin-bottom: 6px;
    font-weight: 500;
  }

  .score-bar-bg {
    height: 5px;
    background: var(--surface2);
    border-radius: 3px;
    overflow: hidden;
  }

  .score-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 1s cubic-bezier(0.4,0,0.2,1);
    width: 0%;
  }

  .score-bar-fill.seo { background: var(--seo); }
  .score-bar-fill.aeo { background: var(--aeo); }
  .score-bar-fill.geo { background: var(--geo); }

  .grade-badge {
    position: absolute;
    top: 18px; right: 18px;
    width: 34px; height: 34px;
    border-radius: var(--radius-xs);
    display: flex; align-items: center; justify-content: center;
    font-weight: 800;
    font-size: 0.95rem;
  }

  .grade-A { background: var(--seo-light); color: var(--seo); }
  .grade-B { background: var(--warn-light); color: var(--warn); }
  .grade-C { background: var(--aeo-light); color: var(--aeo); }
  .grade-D, .grade-F { background: #fde8e8; color: var(--danger); }

  .overall-card {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    padding: 28px 32px;
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 32px;
    flex-wrap: wrap;
    box-shadow: var(--shadow-md);
  }

  .overall-left { flex: 0 0 auto; text-align: center; }
  .overall-score-ring { width: 110px; height: 110px; position: relative; }
  .ring-svg { width: 110px; height: 110px; transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: var(--border); stroke-width: 8; }
  .ring-fill { fill: none; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1.2s cubic-bezier(0.4,0,0.2,1); }

  .overall-number {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    font-weight: 800;
    letter-spacing: -1px;
    color: var(--text);
  }

  .overall-number small {
    font-size: 0.6rem;
    color: var(--muted);
    font-weight: 500;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .overall-right { flex: 1; min-width: 200px; }

  .overall-title {
    font-size: 1.25rem;
    font-weight: 800;
    margin-bottom: 6px;
    letter-spacing: -0.3px;
    color: var(--text);
  }

  .overall-desc { color: var(--muted); font-size: 0.88rem; line-height: 1.6; font-weight: 500; }

  .priority-tag {
    display: inline-block;
    margin-top: 12px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .matrix-section { margin-bottom: 28px; }

  .section-title {
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .checks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 10px;
  }

  .check-item {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
    transition: box-shadow 0.15s, border-color 0.15s;
  }

  .check-item:hover { border-color: var(--border-strong); box-shadow: var(--shadow-sm); }

  .check-icon {
    width: 26px; height: 26px;
    border-radius: var(--radius-xs);
    display: flex; align-items: center; justify-content: center;
    font-size: 13px;
    flex-shrink: 0;
    margin-top: 1px;
    font-weight: 700;
  }

  .check-icon.pass { background: var(--seo-light); color: var(--seo); }
  .check-icon.fail { background: #fde8e8; color: var(--danger); }
  .check-icon.warn { background: var(--warn-light); color: var(--warn); }

  .check-body { flex: 1; }

  .check-name {
    font-size: 0.84rem;
    font-weight: 600;
    margin-bottom: 3px;
    display: flex;
    align-items: center;
    gap: 7px;
    color: var(--text);
    flex-wrap: wrap;
  }

  .check-tag {
    font-size: 0.62rem;
    font-weight: 700;
    letter-spacing: 0.8px;
    padding: 2px 6px;
    border-radius: 4px;
    text-transform: uppercase;
    font-family: 'DM Mono', monospace;
  }

  .tag-seo { background: var(--seo-light); color: var(--seo); }
  .tag-aeo { background: var(--aeo-light); color: var(--aeo); }
  .tag-geo { background: var(--geo-light); color: var(--geo); }

  .check-detail {
    font-size: 0.78rem;
    color: var(--muted);
    line-height: 1.45;
  }

  .suggestions-section { margin-bottom: 28px; }

  .suggestion-item {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    margin-bottom: 8px;
    overflow: hidden;
    transition: box-shadow 0.15s, border-color 0.15s;
  }

  .suggestion-item:hover { border-color: var(--border-strong); box-shadow: var(--shadow-sm); }

  .suggestion-header {
    padding: 15px 18px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    user-select: none;
  }

  .priority-dot {
    width: 9px; height: 9px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .priority-high { background: var(--danger); box-shadow: 0 0 0 3px rgba(220,38,38,0.15); }
  .priority-medium { background: var(--warn); }
  .priority-low { background: var(--seo); }

  .suggestion-title {
    flex: 1;
    font-size: 0.87rem;
    font-weight: 600;
    color: var(--text);
  }

  .suggestion-impact {
    font-size: 0.72rem;
    font-family: 'DM Mono', monospace;
    color: var(--muted);
  }

  .chevron {
    color: var(--muted-light);
    transition: transform 0.2s;
    font-size: 12px;
  }

  .suggestion-item.open .chevron { transform: rotate(90deg); }

  .suggestion-body {
    display: none;
    padding: 0 18px 16px 40px;
    font-size: 0.82rem;
    color: var(--muted);
    line-height: 1.65;
    border-top: 1px solid var(--border);
    padding-top: 14px;
  }

  .suggestion-item.open .suggestion-body { display: block; }

  .fix-code {
    background: #1a1018;
    border: 1.5px solid #2e2028;
    border-radius: var(--radius-sm);
    padding: 14px 16px;
    margin-top: 12px;
    font-family: 'DM Mono', monospace;
    font-size: 0.78rem;
    color: #f0e0e8;
    overflow-x: auto;
    white-space: pre;
    line-height: 1.6;
  }

  .disclaimer {
    text-align: center;
    font-size: 0.75rem;
    color: var(--muted-light);
    font-family: 'DM Mono', monospace;
    margin-top: 40px;
    padding-top: 24px;
    border-top: 1px solid var(--border);
    line-height: 1.7;
  }

  .analyzed-url {
    font-family: 'DM Mono', monospace;
    font-size: 0.78rem;
    color: var(--muted);
    margin-bottom: 22px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    background: var(--surface);
    border: 1.5px solid var(--border);
    padding: 10px 16px;
    border-radius: 8px;
    width: fit-content;
    box-shadow: var(--shadow-sm);
  }

  .pulse {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--cherry);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.75); }
  }

  .error-msg {
    background: #fde8e8;
    border: 1.5px solid #fca5a5;
    border-radius: var(--radius-sm);
    padding: 14px 18px;
    color: var(--danger);
    font-size: 0.84rem;
    display: none;
    margin-top: 12px;
    font-family: 'DM Mono', monospace;
    font-weight: 500;
  }

  .error-msg.active { display: block; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .fade-in { animation: fadeUp 0.35s ease forwards; }
  .fade-in-delay-1 { animation: fadeUp 0.35s 0.08s ease both; }
  .fade-in-delay-2 { animation: fadeUp 0.35s 0.16s ease both; }
  .fade-in-delay-3 { animation: fadeUp 0.35s 0.24s ease both; }

  /* Schema Generator */
  .schema-section { margin-bottom: 32px; }
  .schema-notice {
    background: rgba(255,209,102,0.08);
    border: 1px solid rgba(255,209,102,0.25);
    border-radius: 10px;
    padding: 12px 16px;
    font-size: 0.8rem;
    color: var(--warn);
    margin-bottom: 16px;
    font-family: 'JetBrains Mono', monospace;
    display: flex;
    gap: 10px;
    align-items: flex-start;
    line-height: 1.5;
  }
  .schema-notice strong { color: var(--text); }
  .schema-loading { display: none; text-align: center; padding: 32px 0; }
  .schema-loading.active { display: block; }
  .schema-block {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 14px;
    overflow: hidden;
  }
  .schema-block-header {
    padding: 14px 18px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid var(--border);
  }
  .schema-type-badge {
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-family: 'JetBrains Mono', monospace;
    padding: 3px 8px;
    border-radius: 5px;
    background: rgba(123,108,255,0.12);
    color: var(--geo);
  }
  .schema-block-title { flex: 1; font-size: 0.88rem; font-weight: 600; }
  .schema-copy-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 7px;
    padding: 6px 14px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    cursor: pointer;
    transition: border-color 0.2s, color 0.2s;
  }
  .schema-copy-btn:hover { border-color: var(--geo); color: var(--geo); }
  .schema-copy-btn.copied { border-color: var(--seo); color: var(--seo); }
  .schema-code {
    padding: 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: #c8c8e8;
    overflow-x: auto;
    white-space: pre;
    line-height: 1.6;
    max-height: 280px;
    overflow-y: auto;
    background: var(--surface2);
  }
  .schema-hubspot-steps {
    padding: 14px 18px;
    border-top: 1px solid var(--border);
    font-size: 0.8rem;
    color: var(--muted);
    line-height: 1.7;
  }
  .schema-hubspot-steps strong { color: var(--text); display: block; margin-bottom: 6px; font-size: 0.78rem; }
  .schema-steps-list { list-style: none; counter-reset: steps; padding: 0; }
  .schema-steps-list li { counter-increment: steps; display: flex; gap: 10px; margin-bottom: 4px; }
  .schema-steps-list li::before {
    content: counter(steps);
    min-width: 18px; height: 18px;
    background: var(--geo);
    color: #fff;
    border-radius: 50%;
    font-size: 0.65rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 2px;
    flex-shrink: 0;
  }

</style>
</head>
<body>
<div class="container">

  <header>
    <div class="logo">
      <div class="logo-icon">âš¡</div>
      <div class="logo-text">PageScore</div>
    </div>
    <h1>
      <span class="aeo">AEO</span> Â· <span class="geo">GEO</span> Â· <span class="seo">SEO</span>
    </h1>
    <p class="subtitle">Analyze any page for AI + search visibility</p>
  </header>

  <div class="input-section">

    <div class="input-tabs">
      <button class="input-tab active" id="tabBtnUrl" onclick="switchTab('url')">ðŸ”— URL</button>
      <button class="input-tab" id="tabBtnFile" onclick="switchTab('file')">ðŸ“„ File Upload</button>
      <button class="input-tab" id="tabBtnPaste" onclick="switchTab('paste')">ðŸ“‹ Paste HTML</button>
    </div>

    <!-- URL Tab -->
    <div class="tab-panel active" id="tabUrl">
      <div class="input-row">
        <input
          type="url"
          class="url-input"
          id="urlInput"
          placeholder="https://yourwebsite.com/page"
          autocomplete="off"
        />
        <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">
          Analyze Page â†’
        </button>
      </div>
    </div>

    <!-- File Tab -->
    <div class="tab-panel" id="tabFile">
      <div class="file-drop-zone" id="dropZone">
        <input type="file" id="fileInput" accept=".html,.htm,.txt,.md,.docx" onchange="handleFileSelect(event)"/>
        <div class="file-drop-icon">â¬†</div>
        <div class="file-drop-label">Drop your file here or click to browse</div>
        <div class="file-drop-sub">Supports .html, .htm, .txt, .md, .docx</div>
      </div>
      <div class="file-selected" id="fileSelected">
        <span>ðŸ“„</span>
        <span class="file-selected-name" id="fileSelectedName"></span>
        <button class="file-clear" onclick="clearFile()" title="Remove file">âœ•</button>
      </div>
      <div class="file-analyze-row">
        <button class="analyze-btn" id="analyzeFileBtn" onclick="runAnalysis()" disabled>
          Analyze File â†’
        </button>
      </div>
    </div>

    <!-- Paste HTML Tab -->
    <div class="tab-panel" id="tabPaste">
      <div class="paste-instructions">
        <span class="paste-step">1</span> Open your HubSpot preview (or any page) in Chrome
        <span class="paste-step">2</span> Press <kbd>Ctrl+U</kbd> / <kbd>Cmd+U</kbd> to view source
        <span class="paste-step">3</span> Select all &amp; copy, then paste below
      </div>
      <textarea
        id="pasteInput"
        class="paste-textarea"
        placeholder="Paste your HTML source code here..."
        oninput="handlePasteInput()"
      ></textarea>
      <div class="paste-bottom-row">
        <span class="paste-char-count" id="pasteCharCount">0 characters</span>
        <div style="display:flex;gap:10px;">
          <button class="clear-paste-btn" onclick="clearPaste()">Clear</button>
          <button class="analyze-btn" id="analyzePasteBtn" onclick="runAnalysis()" disabled>
            Analyze HTML â†’
          </button>
        </div>
      </div>
    </div>

    <div class="error-msg" id="errorMsg"></div>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div class="loading-steps" id="loadingSteps">
      <div class="loading-step" id="step1">â¬¡ Fetching page content...</div>
      <div class="loading-step" id="step2">â¬¡ Running SEO checks...</div>
      <div class="loading-step" id="step3">â¬¡ Running AEO checks...</div>
      <div class="loading-step" id="step4">â¬¡ Running GEO checks...</div>
      <div class="loading-step" id="step5">â¬¡ Generating fix suggestions...</div>
    </div>
  </div>

  <div id="results">
    <div class="analyzed-url fade-in">
      <div class="pulse"></div>
      <span id="analyzedUrlDisplay"></span>
    </div>

    <!-- Score Cards -->
    <div class="score-cards fade-in">
      <div class="score-card seo">
        <div class="card-label seo">SEO</div>
        <div class="card-name">Search Engine Optimization</div>
        <div class="score-display">
          <div class="score-number seo" id="seoScore">â€”</div>
          <div class="score-denom">/100</div>
        </div>
        <div class="score-bar-bg"><div class="score-bar-fill seo" id="seoBar"></div></div>
        <div class="grade-badge" id="seoBadge"></div>
      </div>
      <div class="score-card aeo">
        <div class="card-label aeo">AEO</div>
        <div class="card-name">Answer Engine Optimization</div>
        <div class="score-display">
          <div class="score-number aeo" id="aeoScore">â€”</div>
          <div class="score-denom">/100</div>
        </div>
        <div class="score-bar-bg"><div class="score-bar-fill aeo" id="aeoBar"></div></div>
        <div class="grade-badge" id="aeoBadge"></div>
      </div>
      <div class="score-card geo">
        <div class="card-label geo">GEO</div>
        <div class="card-name">Generative Engine Optimization</div>
        <div class="score-display">
          <div class="score-number geo" id="geoScore">â€”</div>
          <div class="score-denom">/100</div>
        </div>
        <div class="score-bar-bg"><div class="score-bar-fill geo" id="geoBar"></div></div>
        <div class="grade-badge" id="geoBadge"></div>
      </div>
    </div>

    <!-- Overall -->
    <div class="overall-card fade-in-delay-1" id="overallCard">
      <div class="overall-left">
        <div class="overall-score-ring">
          <svg class="ring-svg" viewBox="0 0 110 110">
            <circle class="ring-bg" cx="55" cy="55" r="46"/>
            <circle class="ring-fill" id="ringFill" cx="55" cy="55" r="46"
              stroke-dasharray="289"
              stroke-dashoffset="289"
              stroke="url(#ringGrad)"/>
            <defs>
              <linearGradient id="ringGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#e8294a"/>
                <stop offset="100%" stop-color="#ff8fa3"/>
              </linearGradient>
            </defs>
          </svg>
          <div class="overall-number">
            <span id="overallScore">â€”</span>
            <small>Overall</small>
          </div>
        </div>
      </div>
      <div class="overall-right">
        <div class="overall-title" id="overallTitle">Calculating...</div>
        <div class="overall-desc" id="overallDesc"></div>
        <div class="priority-tag" id="priorityTag"></div>
      </div>
    </div>

    <!-- Checks Matrix -->
    <div class="matrix-section fade-in-delay-2">
      <div class="section-title">Checks Matrix</div>
      <div class="checks-grid" id="checksGrid"></div>
    </div>

    <!-- Suggestions -->
    <div class="suggestions-section fade-in-delay-3">
      <div class="section-title">Fix Suggestions â€” Prioritized</div>
      <div id="suggestionsList"></div>
    </div>

    <!-- Schema Generator -->
    <div class="schema-section fade-in-delay-3" id="schemaSection" style="display:none;">
      <div class="section-title">Schema Generator â€” HubSpot Ready</div>
      <div class="schema-notice">
        <span>âš </span> HubSpot auto-generates <strong>BlogPosting</strong> and <strong>WebPage</strong> schema â€” those are excluded below to avoid duplicates. Paste each block into your blog post â†’ <strong>Settings â†’ Advanced Options â†’ Additional code snippets â†’ Head HTML</strong>.
      </div>
      <div id="schemaLoading" class="schema-loading">
        <div class="spinner" style="width:32px;height:32px;margin:0 auto 12px;"></div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:0.8rem;color:var(--muted);">Generating schema...</div>
      </div>
      <div id="schemaBlocks"></div>
    </div>

    <div class="disclaimer">
      Scores are estimated via AI analysis of publicly available page data.<br>
      Actual search rankings depend on many factors including domain authority, backlinks, and competition.<br>
      Re-run after making changes to track improvement.
    </div>
  </div>

</div>


<script>
const ANTHROPIC_API_KEY = null;

// â”€â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchWithClaude(systemPrompt, userContent) {
  const resp = await fetch("https://api.anthropic.com/v1/messages", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "claude-sonnet-4-20250514",
      max_tokens: 4000,
      system: systemPrompt,
      messages: [{ role: "user", content: userContent }]
    })
  });
  if (!resp.ok) throw new Error(`API error: ${resp.status}`);
  const data = await resp.json();
  return data.content[0].text;
}

// â”€â”€â”€ TAB SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeTab = 'url';
let selectedFileContent = null;
let selectedFileName = null;

function switchTab(tab) {
  activeTab = tab;
  ['url','file','paste'].forEach(t => {
    document.getElementById('tabBtn' + t.charAt(0).toUpperCase() + t.slice(1)).classList.toggle('active', t === tab);
    document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1)).classList.toggle('active', t === tab);
  });
  document.getElementById('errorMsg').classList.remove('active');
}

// â”€â”€â”€ FILE HANDLING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleFileSelect(event) {
  const file = event.target.files[0];
  if (!file) return;
  const isDocx = file.name.endsWith('.docx');
  if (isDocx) {
    const reader = new FileReader();
    reader.onload = async (e) => {
      try {
        const result = await mammoth.extractRawText({ arrayBuffer: e.target.result });
        selectedFileContent = result.value;
        selectedFileName = file.name;
        document.getElementById('fileSelectedName').textContent = file.name;
        document.getElementById('fileSelected').classList.add('active');
        document.getElementById('analyzeFileBtn').disabled = false;
      } catch(err) {
        showError('Could not read Word doc. Make sure it is a valid .docx file.');
      }
    };
    reader.readAsArrayBuffer(file);
  } else {
    const reader = new FileReader();
    reader.onload = (e) => {
      selectedFileContent = e.target.result;
      selectedFileName = file.name;
      document.getElementById('fileSelectedName').textContent = file.name;
      document.getElementById('fileSelected').classList.add('active');
      document.getElementById('analyzeFileBtn').disabled = false;
    };
    reader.readAsText(file);
  }
}

function clearFile() {
  selectedFileContent = null;
  selectedFileName = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('fileSelected').classList.remove('active');
  document.getElementById('analyzeFileBtn').disabled = true;
}

// â”€â”€â”€ PASTE HANDLING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handlePasteInput() {
  const val = document.getElementById('pasteInput').value;
  document.getElementById('pasteCharCount').textContent = val.length.toLocaleString() + ' characters';
  document.getElementById('analyzePasteBtn').disabled = val.length < 50;
}

function clearPaste() {
  document.getElementById('pasteInput').value = '';
  document.getElementById('pasteCharCount').textContent = '0 characters';
  document.getElementById('analyzePasteBtn').disabled = true;
}

// â”€â”€â”€ DRAG AND DROP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  const dropZone = document.getElementById('dropZone');
  if (dropZone) {
    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) handleFileSelect({ target: { files: [file] } });
    });
  }
  document.getElementById('urlInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') runAnalysis();
  });
});

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showError(msg) {
  const el = document.getElementById('errorMsg');
  el.textContent = 'âœ— ' + msg;
  el.classList.add('active');
}

function setStep(n) {
  document.querySelectorAll('.loading-step').forEach((el, i) => {
    if (i < n) { el.classList.add('visible','done'); el.textContent = el.textContent.replace('â¬¡','âœ“'); }
    else if (i === n) el.classList.add('visible');
  });
}

function grade(score) {
  if (score >= 90) return 'A';
  if (score >= 75) return 'B';
  if (score >= 60) return 'C';
  if (score >= 45) return 'D';
  return 'F';
}

function escapeHtml(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function animateScore(el, barEl, target, delay) {
  setTimeout(() => {
    let c = 0;
    const step = target / 40;
    const t = setInterval(() => {
      c = Math.min(c + step, target);
      el.textContent = Math.round(c);
      barEl.style.width = c + '%';
      if (c >= target) clearInterval(t);
    }, 20);
  }, delay);
}

function overallSummary(avg) {
  if (avg >= 85) return ['Excellent Visibility', 'Your page is well-optimized for both search engines and AI platforms.', 'Keep up the momentum', '#00e5a0'];
  if (avg >= 70) return ['Good Foundation', 'Solid optimization in most areas. A few targeted fixes could significantly boost visibility.', 'Quick wins available', '#ffd166'];
  if (avg >= 50) return ['Needs Improvement', 'Several gaps are limiting your discoverability. Address high-priority suggestions first.', 'Action required', '#ff6b35'];
  return ['Critical Issues Found', 'Major optimization gaps are severely limiting visibility. Prioritize high-impact fixes immediately.', 'Urgent attention needed', '#ff4d6d'];
}

function stripHtml(html) {
  const schemaBlocks = [];
  html = html.replace(/<script[^>]*type=["']application\/ld\+json["'][^>]*>([\s\S]*?)<\/script>/gi, match => {
    schemaBlocks.push(match);
    return '';
  });
  html = html.replace(/<script[\s\S]*?<\/script>/gi, '');
  html = html.replace(/<style[\s\S]*?<\/style>/gi, '');
  html = html.replace(/<(nav|header|footer)[\s\S]*?<\/\1>/gi, '');
  html = html.replace(/<link[^>]*>/gi, '');
  html = html.replace(/<noscript[\s\S]*?<\/noscript>/gi, '');
  html = html.replace(/ on\w+="[^"]*"/gi, '');
  html = html.replace(/\s{2,}/g, ' ').trim();
  if (schemaBlocks.length > 0) html = schemaBlocks.join('\n') + '\n' + html;
  return html;
}

// â”€â”€â”€ BUILD RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildChecks(checks) {
  const grid = document.getElementById('checksGrid');
  grid.innerHTML = '';
  checks.forEach(c => {
    const icons = { pass: 'âœ“', fail: 'âœ—', warn: '!' };
    const div = document.createElement('div');
    div.className = 'check-item';
    div.innerHTML = `
      <div class="check-icon ${c.status}">${icons[c.status] || '?'}</div>
      <div class="check-body">
        <div class="check-name">${escapeHtml(c.name)} <span class="check-tag tag-${c.type}">${c.type.toUpperCase()}</span></div>
        <div class="check-detail">${escapeHtml(c.detail)}</div>
      </div>`;
    grid.appendChild(div);
  });
}

function buildSuggestions(suggestions) {
  const list = document.getElementById('suggestionsList');
  list.innerHTML = '';
  const order = { high: 0, medium: 1, low: 2 };
  suggestions.sort((a, b) => (order[a.priority] || 0) - (order[b.priority] || 0));
  suggestions.forEach(s => {
    const div = document.createElement('div');
    div.className = 'suggestion-item';
    const fixCode = s.fix ? `<div class="fix-code">${escapeHtml(s.fix)}</div>` : '';
    div.innerHTML = `
      <div class="suggestion-header" onclick="this.closest('.suggestion-item').classList.toggle('open')">
        <div class="priority-dot priority-${s.priority}"></div>
        <div class="suggestion-title">${escapeHtml(s.title)} <span class="check-tag tag-${s.type}">${s.type.toUpperCase()}</span></div>
        <div class="suggestion-impact">${escapeHtml(s.impact)}</div>
        <span class="chevron">â€º</span>
      </div>
      <div class="suggestion-body"><p>${escapeHtml(s.description)}</p>${fixCode}</div>`;
    list.appendChild(div);
  });
}

// â”€â”€â”€ SCHEMA GENERATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateSchema(pageContent) {
  document.getElementById('schemaSection').style.display = 'block';
  document.getElementById('schemaLoading').classList.add('active');
  document.getElementById('schemaBlocks').innerHTML = '';

  const system = `You are a schema markup expert for HubSpot blog posts. Generate JSON-LD schema markup.

RULES:
- HubSpot already auto-generates BlogPosting and WebPage schema â€” do NOT generate those
- Only generate: FAQPage (if FAQs exist), BreadcrumbList (always include if URL is available), ItemList (if comparing products/services)
- Use real content from the page â€” actual FAQ questions, real breadcrumb paths, real list items
- Each json field must be a complete valid JSON-LD object (without @context, that gets added automatically)

Respond ONLY with a valid JSON array, no markdown, no extra text:
[{"type":"FAQPage","title":"FAQ Schema","applicable":true,"reason":"one sentence why","json":{...}},...]

Set applicable:false for types that don't fit. Only include types listed above.`;

  try {
    const raw = await fetchWithClaude(system, `Generate schema for this page:\n\n${pageContent.slice(0, 40000)}`);
    const cleaned = raw.replace(/```json\n?/g,'').replace(/```\n?/g,'').trim();
    const schemas = JSON.parse(cleaned);
    buildSchemaBlocks(schemas);
  } catch(e) {
    document.getElementById('schemaBlocks').innerHTML = `<div style="font-family:'JetBrains Mono',monospace;font-size:0.8rem;color:var(--danger);padding:16px;">Could not generate schema. Try re-running the analysis.</div>`;
  }
  document.getElementById('schemaLoading').classList.remove('active');
}

function buildSchemaBlocks(schemas) {
  const container = document.getElementById('schemaBlocks');
  container.innerHTML = '';
  const applicable = schemas.filter(s => s.applicable !== false && s.json);
  if (!applicable.length) {
    container.innerHTML = `<div style="font-family:'JetBrains Mono',monospace;font-size:0.8rem;color:var(--muted);padding:16px;">No additional schema types detected for this page.</div>`;
    return;
  }
  applicable.forEach(s => {
    const fullObj = { "@context": "https://schema.org", ...s.json };
    const jsonStr = JSON.stringify(fullObj, null, 2);
    const fullScript = `<script type="application/ld+json">\n${jsonStr}\n<\/script>`;
    const id = 'schema_' + s.type.replace(/\W/g,'_') + '_' + Date.now();
    const div = document.createElement('div');
    div.className = 'schema-block';
    div.innerHTML = `
      <div class="schema-block-header">
        <span class="schema-type-badge">${escapeHtml(s.type)}</span>
        <span class="schema-block-title">${escapeHtml(s.title)}</span>
        <button class="schema-copy-btn" onclick="copySchema('${id}',this)">Copy Code</button>
      </div>
      <div class="schema-code" id="${id}">${escapeHtml(fullScript)}</div>
      ${s.reason ? `<div style="padding:10px 16px;font-family:'JetBrains Mono',monospace;font-size:0.73rem;color:var(--muted);border-top:1px solid var(--border);">ðŸ’¡ ${escapeHtml(s.reason)}</div>` : ''}`;
    container.appendChild(div);
  });
}

function copySchema(id, btn) {
  const el = document.getElementById(id);
  const txt = el.textContent.replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');
  navigator.clipboard.writeText(txt).then(() => {
    btn.textContent = 'âœ“ Copied!';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'Copy Code'; btn.classList.remove('copied'); }, 2000);
  });
}

// â”€â”€â”€ MAIN ANALYSIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ANALYSIS_SYSTEM = `You are an expert SEO/AEO/GEO analyst. Analyze pages across three dimensions:
- SEO: title tags, meta descriptions, headings, keywords, internal links, image alt text, canonical tags, structured data
- AEO: FAQ schemas, direct answers, question-based headings, featured snippet optimization, concise definitions
- GEO: authoritative content, citations, author info, E-E-A-T signals, factual density, comprehensiveness, trust signals

Respond ONLY with valid JSON, no markdown:
{
  "seo_score": 0-100,
  "aeo_score": 0-100,
  "geo_score": 0-100,
  "checks": [{"name":"...","type":"seo|aeo|geo","status":"pass|fail|warn","detail":"..."}],
  "suggestions": [{"priority":"high|medium|low","type":"seo|aeo|geo","title":"...","impact":"...","description":"...","fix":"..."}],
  "summary": "2-sentence assessment"
}
Include at least 12 checks and 6 suggestions.`;

async function runAnalysis() {
  const errorMsg = document.getElementById('errorMsg');
  errorMsg.classList.remove('active');

  let userContent = '';
  let displayLabel = '';
  let btn;

  if (activeTab === 'url') {
    const url = document.getElementById('urlInput').value.trim();
    if (!url || !url.startsWith('http')) { showError('Please enter a valid URL starting with https://'); return; }
    userContent = `Analyze this URL for SEO, AEO, and GEO:\n\nURL: ${url}\n\nConsider URL structure, domain signals, likely content type, and industry best practices.`;
    displayLabel = 'Analyzed: ' + url;
    btn = document.getElementById('analyzeBtn');

  } else if (activeTab === 'paste') {
    const html = document.getElementById('pasteInput').value.trim();
    if (!html || html.length < 50) { showError('Please paste some HTML content first.'); return; }
    const content = stripHtml(html).slice(0, 100000);
    userContent = `Analyze this HTML page source for SEO, AEO, and GEO:\n\n${content}`;
    displayLabel = 'Analyzed: Pasted HTML source';
    btn = document.getElementById('analyzePasteBtn');

  } else {
    if (!selectedFileContent) { showError('Please select a file first.'); return; }
    const content = stripHtml(selectedFileContent).slice(0, 100000);
    userContent = `Analyze this page content from file "${selectedFileName}" for SEO, AEO, and GEO:\n\n${content}`;
    displayLabel = 'Analyzed: ' + selectedFileName;
    btn = document.getElementById('analyzeFileBtn');
  }

  btn.disabled = true;
  btn.textContent = 'Analyzing...';
  document.getElementById('loading').classList.add('active');
  document.getElementById('results').classList.remove('active');
  document.getElementById('schemaSection').style.display = 'none';

  const stepTexts = ['â¬¡ Reading content...','â¬¡ Running SEO checks...','â¬¡ Running AEO checks...','â¬¡ Running GEO checks...','â¬¡ Generating suggestions...'];
  document.querySelectorAll('.loading-step').forEach((el, i) => {
    el.classList.remove('visible','done');
    el.textContent = stepTexts[i];
  });

  try {
    setStep(0);
    setTimeout(() => setStep(1), 600);
    setTimeout(() => setStep(2), 1200);
    setTimeout(() => setStep(3), 1800);
    setTimeout(() => setStep(4), 2400);

    const raw = await fetchWithClaude(ANALYSIS_SYSTEM, userContent);
    const cleaned = raw.replace(/```json\n?/g,'').replace(/```\n?/g,'').trim();
    const data = JSON.parse(cleaned);

    document.getElementById('loading').classList.remove('active');
    document.getElementById('analyzedUrlDisplay').textContent = displayLabel;
    document.getElementById('results').classList.add('active');

    animateScore(document.getElementById('seoScore'), document.getElementById('seoBar'), data.seo_score, 100);
    animateScore(document.getElementById('aeoScore'), document.getElementById('aeoBar'), data.aeo_score, 200);
    animateScore(document.getElementById('geoScore'), document.getElementById('geoBar'), data.geo_score, 300);

    ['seo','aeo','geo'].forEach(t => {
      const g = grade(data[t + '_score']);
      const badge = document.getElementById(t + 'Badge');
      badge.className = 'grade-badge grade-' + g;
      badge.textContent = g;
    });

    const avg = Math.round((data.seo_score + data.aeo_score + data.geo_score) / 3);
    const ringFill = document.getElementById('ringFill');
    setTimeout(() => {
      let c = 0;
      const t = setInterval(() => {
        c = Math.min(c + avg / 40, avg);
        document.getElementById('overallScore').textContent = Math.round(c);
        ringFill.style.strokeDashoffset = 289 - (289 * c / 100);
        if (c >= avg) clearInterval(t);
      }, 20);
    }, 400);

    const [title, desc, tag, color] = overallSummary(avg);
    document.getElementById('overallTitle').textContent = title;
    document.getElementById('overallDesc').textContent = data.summary || desc;
    const pt = document.getElementById('priorityTag');
    pt.textContent = tag;
    pt.style.background = color + '20';
    pt.style.color = color;

    buildChecks(data.checks || []);
    buildSuggestions(data.suggestions || []);

    // Run schema generation as a second pass
    generateSchema(userContent);

  } catch(err) {
    document.getElementById('loading').classList.remove('active');
    showError(err.message);
  }

  btn.disabled = false;
  if (activeTab === 'url') btn.textContent = 'Analyze Page â†’';
  else if (activeTab === 'paste') btn.textContent = 'Analyze HTML â†’';
  else btn.textContent = 'Analyze File â†’';
}
</script>
</body>
</html>
